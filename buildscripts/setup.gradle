def renameConfig = [
        templatePackage: "template",
        newPackage     : "domain.yourname.app",
]

task renameAppPackage(type: Copy) {
    description "Renames the template package in the app module."
    group "Template Setup"

    def newPackageAsDirectory = renameConfig.newPackage.replaceAll("\\.", "/")
    def startingDirectory = "${rootDir}/app/src/main/java/${renameConfig.templatePackage}"
    def endingDirectory = "${rootDir}/app/src/main/java/${newPackageAsDirectory}"

    from(startingDirectory)
    into(endingDirectory)

    // Replace import statements
    filter { line ->
        line.replaceAll(
                "package ${renameConfig.templatePackage}",
                "package ${renameConfig.newPackage}"
        )
    }

    doLast {
        delete(startingDirectory)
    }
}

task replacePackageInManifest {
    description "Replaces references to template in AndroidManifest.xml file."
    group "Template Setup"

    def file = new File("${rootDir}/app/src/main/AndroidManifest.xml")

    // Replace package
    file.text = file.text.replaceAll(
            "package=\"${renameConfig.templatePackage}\"",
            "package=\"${renameConfig.newPackage}\"",
    )

    // Replace MainActivity reference
    file.text = file.text.replaceAll(
            "${renameConfig.templatePackage}.MainActivity",
            "${renameConfig.newPackage}.MainActivity",
    )
}
